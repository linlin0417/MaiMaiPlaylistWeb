# maimai æ’­æ”¾æ¸…å–®ç³»çµ± - DirectAdmin éƒ¨ç½²æ•…éšœæ’é™¤æŒ‡å—

## ğŸ”§ éƒ¨ç½²å•é¡Œè¨ºæ–·æ­¥é©Ÿ

### 1. ç’°å¢ƒæª¢æŸ¥
é¦–å…ˆåŸ·è¡Œç’°å¢ƒæª¢æŸ¥è…³æœ¬ï¼š
```bash
node check-env.js
```

### 2. å¸¸è¦‹å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆ

#### å•é¡Œ A: æˆæ¬Šç¢¼ä¸ä¸€è‡´
**ç—‡ç‹€**: ç„¡æ³•ç™»å…¥æˆ–æˆæ¬Šç¢¼éŒ¯èª¤
**åŸå› **: DirectAdmin ä¸­è¨­å®šçš„ AUTH_CODE èˆ‡æ‡‰ç”¨ç¨‹å¼ä¸ç¬¦
**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ DirectAdmin ç’°å¢ƒè®Šæ•¸è¨­å®š
2. ç¢ºèª AUTH_CODE å€¼æ˜¯å¦æ­£ç¢º
3. å¦‚åœ–ç‰‡æ‰€ç¤ºï¼Œæ‚¨è¨­å®šçš„æ˜¯ `maimai`ï¼Œä½†é è¨­å€¼æ˜¯ `maimai2024`

#### å•é¡Œ B: æª”æ¡ˆæ¬Šé™éŒ¯èª¤
**ç—‡ç‹€**: ç„¡æ³•å»ºç«‹ data/ æˆ– backup/ ç›®éŒ„
**åŸå› **: Node.js ç¨‹åºæ²’æœ‰å¯«å…¥æ¬Šé™
**è§£æ±ºæ–¹æ¡ˆ**:
1. æ‰‹å‹•å»ºç«‹ç›®éŒ„ï¼š
   ```bash
   mkdir data backup
   chmod 755 data backup
   ```
2. æª¢æŸ¥æª”æ¡ˆæ“æœ‰è€…æ¬Šé™

#### å•é¡Œ C: ä¾è³´é …ç¼ºå¤±
**ç—‡ç‹€**: æ¨¡çµ„æ‰¾ä¸åˆ°æˆ– require éŒ¯èª¤
**åŸå› **: npm ä¾è³´é …æœªæ­£ç¢ºå®‰è£
**è§£æ±ºæ–¹æ¡ˆ**:
1. åˆªé™¤ node_modulesï¼š`rm -rf node_modules`
2. é‡æ–°å®‰è£ï¼š`npm install --production`
3. ç¢ºèª Node.js ç‰ˆæœ¬ >= 14.0.0

#### å•é¡Œ D: åŸ è™Ÿè¡çª
**ç—‡ç‹€**: ä¼ºæœå™¨ç„¡æ³•å•Ÿå‹•ï¼ŒåŸ è™Ÿè¢«ä½”ç”¨
**åŸå› **: æŒ‡å®šçš„åŸ è™Ÿå·²è¢«ä½¿ç”¨
**è§£æ±ºæ–¹æ¡ˆ**:
1. åœ¨ DirectAdmin ä¸­è¨­å®šä¸åŒçš„ PORT ç’°å¢ƒè®Šæ•¸
2. æˆ–è®“ç³»çµ±è‡ªå‹•åˆ†é…åŸ è™Ÿ

#### å•é¡Œ E: éœæ…‹æª”æ¡ˆç„¡æ³•è¼‰å…¥
**ç—‡ç‹€**: ç¶²é æ¨£å¼ç•°å¸¸æˆ– JavaScript éŒ¯èª¤
**åŸå› **: public/ ç›®éŒ„æª”æ¡ˆç¼ºå¤±æˆ–è·¯å¾‘éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªä¸Šå‚³äº†å®Œæ•´çš„ public/ ç›®éŒ„
2. æª¢æŸ¥æª”æ¡ˆæ¬Šé™ï¼š`chmod 644 public/*`

## ğŸš€ æ­£ç¢ºéƒ¨ç½²æ­¥é©Ÿ

### 1. æª”æ¡ˆæº–å‚™
ç¢ºä¿ä¸Šå‚³ä»¥ä¸‹æª”æ¡ˆåˆ°ä¼ºæœå™¨ï¼š
```
app.js
package.json
start.js
check-env.js
public/
â”œâ”€â”€ index.html
â”œâ”€â”€ script.js
â””â”€â”€ styles.css
```

### 2. DirectAdmin è¨­å®š
åœ¨ Node.js æ‡‰ç”¨ç¨‹å¼è¨­å®šä¸­ï¼š
- **Application root**: `domains/note.yukimurasaya.top/web/maimai`
- **Application URL**: `maimai.note.yukimurasaya.top` 
- **Application startup file**: `app.js`
- **Node.js version**: é¸æ“‡ 14.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### 3. ç’°å¢ƒè®Šæ•¸è¨­å®š
åœ¨ DirectAdmin ä¸­æ–°å¢ä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š
```
AUTH_CODE=maimai
NODE_ENV=production
```

### 4. ä¾è³´å®‰è£
åœ¨ DirectAdmin çš„çµ‚ç«¯æ©Ÿæˆ–é€éæ§åˆ¶é¢æ¿åŸ·è¡Œï¼š
```bash
npm install --production
```

### 5. å•Ÿå‹•æ¸¬è©¦
```bash
# ç’°å¢ƒæª¢æŸ¥
npm run check

# å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
npm start
```

## ğŸ” é™¤éŒ¯æŒ‡ä»¤

### æª¢æŸ¥æ—¥èªŒ
```bash
# æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
tail -f logs/nodejs.log

# æª¢æŸ¥ç³»çµ±æ—¥èªŒ  
journalctl -u nodejs-app
```

### æ¸¬è©¦é€£ç·š
```bash
# æ¸¬è©¦æœ¬æ©Ÿé€£ç·š
curl http://localhost:3000

# æ¸¬è©¦ç¶²åŸŸé€£ç·š
curl http://maimai.note.yukimurasaya.top
```

### æª¢æŸ¥ç¨‹åº
```bash
# æŸ¥çœ‹ Node.js ç¨‹åº
ps aux | grep node

# æª¢æŸ¥åŸ è™Ÿä½¿ç”¨æƒ…æ³
netstat -tulpn | grep :3000
```

## ğŸ“ å°‹æ±‚å”åŠ©

å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨ï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š
1. `node check-env.js` çš„å®Œæ•´è¼¸å‡º
2. DirectAdmin ä¸­çš„éŒ¯èª¤è¨Šæ¯
3. ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·çš„éŒ¯èª¤è³‡è¨Š
4. ç³»çµ±æ—¥èªŒçš„ç›¸é—œç‰‡æ®µ

## ğŸ’¡ ç”Ÿç”¢ç’°å¢ƒæœ€ä½³å¯¦å‹™

1. **å®‰å…¨æ€§**:
   - ä½¿ç”¨å¼·å¯†ç¢¼ä½œç‚º AUTH_CODE
   - å®šæœŸæ›´æ›æˆæ¬Šç¢¼
   - å•Ÿç”¨ HTTPS

2. **æ•ˆèƒ½**:
   - ä½¿ç”¨ PM2 æˆ–é¡ä¼¼å·¥å…·ç®¡ç†ç¨‹åº
   - è¨­å®šæ—¥èªŒè¼ªè½‰
   - å®šæœŸå‚™ä»½è³‡æ–™

3. **ç›£æ§**:
   - è¨­å®šå¥åº·æª¢æŸ¥
   - ç›£æ§ç£ç¢Ÿç©ºé–“ä½¿ç”¨
   - å®šæœŸæª¢æŸ¥éŒ¯èª¤æ—¥èªŒ
